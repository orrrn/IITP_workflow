# This Playbook is malware on an Endpoint abuse playbook
# In exabeam
# Written in Sudocode

def main(step):
    define_your_triggers()
    Quarantine_the_endpoint()
    investigate_the_source_and_scope_of_the_infection()
    analyze_the_infection()
    prevention()


def define_your_triggers():
    goto check_AV_alerts-Alerts_use_traditional_malware-centric_signature-_and_heuristic-based_detection
    goto check_Next-gen_AV-In_this_more_system-centric_approach,_processes,_methods,_techniques,_and_procedures_indicate_malicious_intent
    goto check_Initial_EXE_launch-The_first_time_an_application_is_run_can_indicate_malware_or_hacker_tools
    goto check_Outbound_traffic_signature-The_use_of_DNS_and_specific_traffic_patterns_can_be_analyzed_to_identify_malicious_activity
    goto check_User_reports-Helpdesk_calls_around_poor_performance_can_be_a_leading_indicator


def Quarantine_the_endpoint():
    goto quarantining_physically_virtually_through_network_segmentation
    goto check_endpoint_is_isolated
    goto check_endpoint_is_not_accessible_from_the_internet

def investigate_the_source_and_scope_of_the_infection():
    if prior_to_infection:
        goto Review_downloaded_files_visited sites_and_incoming_email_from_first-time_senders
        goto check_informations_to_provide_context_around_how_the_system_became_infected
    else if after_infection:
        goto Look_for_abnormal_or_questionable_programs_that_were_executed
        goto check_account_switches_in_command_lines_and_outgoing_email_to_see_which_additional_actions_were_taken
        goto determine_whether_the_primary_user_behavior_has_changed_since_the_system_was_infected
    endif

    goto Identify_the_users_that_have_used_the_endpoint_recently
    goto check_user_logged_on_recently_gives_IT_insight_into_which_resources_and_systems_might_have_been_compromised
    goto See_ordinary_indicates_the_malicious_use_of_compromised_credentials

def analyze_the_infection():
    goto look_for_similar_evidence_on_other_users_or_endpoints
    goto establish_whatâ€™s_normal_for_your_users_and_endpoints
    goto find_machines_that_are_infected_with_the_same_ransomware
    if finish_investigating:
        goto get_how_the_malware_came_in
        goto get_which_tactics_it_used
        goto get_how_it_spread
        goto get_how_it_functions
        
def prevention():
    goto Block_the_infection_vetor
    goto update_countinually_patches_security_policies_and_firewall_settings
    goto Block_malicious_outbound_connections
    goto use Command_&_control(C&C)connections_for_arming_malware
    goto use Network_IDS_for_intraconnections